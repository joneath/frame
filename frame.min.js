!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){b.exports=Backbone.Model.extend({defaults:{modelPath:"models/",collectionsPath:"collections/",controllerPath:"controllers/",middlewarePath:"middlewares/",mixinPath:"mixins/",followLinks:!0,routes:{}},initialize:function(a){a&&this.set(a),this.get("followLinks")&&(this._linkHelper=new Frame.LinkHelper),this._dispatcher=new Frame.Dispatcher({routes:this.get("routes"),controllerPath:this.get("controllerPath"),middlewarePath:this.get("middlewarePath")}),$(function(){Backbone.history.start({pushState:!0})}),Frame._app=this}})},{}],2:[function(a,b){var c,d=a("./collection_manager"),e=a("./model_factory"),f=a("./mediator"),g=a("./mixin"),h=/(\(\?)?:\w+/g;b.exports=c=Backbone.Collection.extend({mediator:f,modelName:"base",initialize:function(a,b){b||(b={}),this.setFetched(!!b.fetched),this._resourceId=b.resourceId,this._nested=b.nested,this._resourceUrl=this.url,this.url=this._url,this.allowEmpty=this.allowEmpty,this.init.apply(this,arguments)},init:function(){},_url:function(){var a=_.result(this,"_resourceUrl"),b=0;if(!a)throw"url is required to fetch resource";return a=a.replace(h,function(a){return a=this._nested[b],b+=1,a}.bind(this))},_prepareModel:function(a,b){if(a instanceof Backbone.Model)return a;b=b?_.clone(b):{},b.collection=this;var c=this.model(a,b);return c.validationError?(this.trigger("invalid",this,c.validationError,b),!1):c},model:function(a,b){var c=e(this.modelName,a,b);return c.id&&"base"!=this.modelName&&c.store(this.modelName+":"+c.id),_.keys(a).length>1&&c.setFetched(!0),c},move:function(a,b){var c=this.indexOf(a);if(-1==c)throw new Error("Can't move a model that's not in the collection");c!==b&&this.models.splice(b,0,this.models.splice(c,1)[0]),this.trigger("move",a,c,b)},store:function(a){d.set(a,this)},isFetched:function(){return this._fetched},setFetched:function(a){this._fetched=a,a&&(this.promise=$.Deferred().resolve(this))},fetch:function(){return this.promise=Backbone.Collection.prototype.fetch.apply(this,arguments).then(function(){(this.length||this.allowEmpty)&&this.setFetched(!0),this.trigger("fetched")}),this.trigger("fetch",this.promise),this.promise},fetchCached:function(a){return this.isFetched()?$.Deferred().resolve(this):this.promise&&"pending"===this.promise.state()?this.promise:this.fetch(a)}}),c.mixin=g},{"./collection_manager":4,"./mediator":10,"./mixin":11,"./model_factory":13}],3:[function(a,b){b.exports=function(b,c,d){var e,f;if(!b||!_.isString(b))throw"Collection type is required!";if(e=Frame._app.get("collectionPath")+b,f=a(e),!f)throw e+" is an undefined collection";return new f(c,d)}},{}],4:[function(a,b){b.exports={get:function(a,b,c,d){var e=a+":"+b,f=Frame._appCollections[e];return f&&f._TTL<=Date.now()&&(f=null),f||(f=Frame._collectionFactory(a,c,d),this.set(e,f)),f},set:function(a,b){Frame._appCollections[a]=b,b._TTL=Date.now()+(b.cacheTTL||3e5),b.on("change",this._updateTTL)},destroy:function(a){var b=Frame._appCollections[a];b.off("change",this._updateTTL),delete Frame._appCollections[a]},_updateTTL:function(){this._TTL=Date.now()+(this.cacheTTL||3e5)}}},{}],5:[function(a,b){function c(a,b,c){return _.isEmpty(c)?a:a.replace(b,function(a){return c[a]})}var d,e=a("./model_manager"),f=a("./collection_manager"),g=a("./fetcher"),h=a("./mediator"),i=a("./mixin"),j=["bodyClass","el"];b.exports=d=function(a){this.cid=_.uniqueId("controller"),this._configure(a||{}),this.views=[],this._actionResources={},_.each(this.resources,function(a,b){var c=a.actions;a.name=b,c&&"all"!==c[0]||(c=_.keys(this.actions)),_.each(c,function(b){var c;_.isArray(this._actionResources[b])||(this._actionResources[b]=[]),c=this._actionResources[b],c.push(a)},this)},this),this.$el=$(this.el?this.el:"<div/>"),this.initialize.apply(this,arguments)},_.extend(d.prototype,Backbone.Events,{mediator:h,fetcher:g,modelManager:e,collectionManager:f,initialize:function(){},_configure:function(a){this.options&&(a=_.extend({},_.result(this,"options"),a)),_.extend(this,_.pick(a,j)),this.options=a},_action:function(a){var b,d=_.compact(Array.prototype.slice.call(arguments,1)),e=this.actions[a],f=[];if(!_.isFunction(e))throw"Controller does not support the "+a+" action!";if($("html, body").scrollTop(0),this.setBodyClass(this.bodyClass),b=this._actionResources[a],_.isArray(b)&&b.length){var g,h,i,j={},k={},l=1;_.each(d,function(a){k["$"+l]=a,l+=1}),d.length&&(i=d[d.length-1]),_.each(b,function(a){h="",g=null,a.id&&(h=_.isFunction(a.id)?a.id.apply(this,d):c(a.id,/\$\d+/g,k)),a.params&&(g={},_.each(a.params,function(a,b){a=c(a,/\$\d+/g,k),g[b]=a}));var b=this.fetcher.fetch({id:h,data:a.model?{id:i}:null,model:a.model,collection:a.collection,options:{resourceId:h,nested:d},fetchOptions:{data:g}});a.wait&&f.push(b.promise),j[a.name]=b},this),$.when.apply($,f).always(function(){e.call(this,j,d)}.bind(this))}else e.apply(this,d)},append:function(a){return _.isArray(a)||(a=[a]),_.each(a,function(a){this.views.push(a),this.$el.append(a.render().$el),a._onInsert()},this),this},setBodyClass:function(a){$("body").removeClass(this.bodyClass),$("body").removeClass(this.actionBodyClass),this.actionBodyClass=a,this.actionBodyClass&&$("body").addClass(this.actionBodyClass)},setPageTitle:function(a){$("title").text(a)},remove:function(){$("body").removeClass(this.bodyClass),$("body").removeClass(this.actionBodyClass),_.invoke(this.views,"remove"),this.$el.empty(),this.views=[]}}),d.extend=Backbone.Model.extend,d.mixin=i},{"./collection_manager":4,"./fetcher":7,"./mediator":10,"./mixin":11,"./model_manager":14}],6:[function(a,b){var c,d=a("./mediator"),e=["routes","controllerPath","middlewarePath"];b.exports=c=function(a){this.cid=_.uniqueId("dispatcher"),this._configure(a||{}),this._router=new Backbone.Router,this.buildRoutes(this.routes),this.initialize.apply(this,arguments)},_.extend(c.prototype,Backbone.Events,{nestCount:0,controllerPath:"controllers/",middlewarePath:"middlewares/",mediator:d,initialize:function(){this.mediator.on("navigate",this._router.navigate,this),this.on("dispatched",function(){this.mediator.trigger("dispatched")},this)},_configure:function(a){this.options&&(a=_.extend({},_.result(this,"options"),a)),_.extend(this,_.pick(a,e)),this.options=a},loadMiddlewares:function(b){return _.map(b,function(b){return a(this.middlewarePath+b)},this)},buildRoutes:function(a,b,c){var d;b||(b=""),this.nestCount+=1,_.each(a,function(a,e){c||(c=[]),"middleware"===e?(_.isArray(a)||(a=[a]),c=c.concat(this.loadMiddlewares(a))):_.isObject(a)?(1===this.nestCount?b=e:b+=e,this.buildRoutes(a,b,c),this.nestCount-=1):(d=e,b&&(d=b+d),this._router.route(d,_.bind(this.dispatch,this,a,c)))},this)},dispatch:function(b,c){var d=Array.prototype.slice.call(arguments,2),e=b.split("#"),f=e[0],g=e[1],h=a(this.controllerPath+f),i="";if(c&&c.length&&_.each(c,function(a){a.apply(null,d)}),!h)throw f+" is not a defined controller";if(d.unshift(g),this._activeController&&this._activeController.remove(),this._activeController&&this._activeControllerName===f||(this._activeController=new h(d)),i=this._activeController.actions[g],!i)throw f+" controller has not implemented "+g;this._activeController._action.apply(this._activeController,d),this._activeControllerName=f,this.trigger("dispatched",f,g)}}),c.extend=Backbone.Model.extend},{"./mediator":10}],7:[function(a,b){var c=a("./model_manager"),d=a("./collection_manager");b.exports={fetch:function(a){var b;return b=a.model?c.get(a.model,a.id,a.data,a.options):d.get(a.collection,a.id,a.data,a.options),b.fetchCached(a.fetchOptions),b}}},{"./collection_manager":4,"./model_manager":14}],8:[function(a){!function(a){"function"==typeof define&&define.amd?define(["backbone","underscore","jquery","exports"],function(b,c,d,e){this.Frame=a(this,e,b,c,d)}):this.Frame=a(this,{},this.Backbone,this._,this.jQuery||this.Zepto||this.ender||this.$)}(function(b,c,d,e){return e.extend(c,{_appModels:{},_appCollections:{},App:a("./app"),mediator:a("./mediator"),mixin:a("./mixin"),LinkHelper:a("./link_helper"),modelFactory:a("./model_factory"),modelManager:a("./model_manager"),collectionFactory:a("./collection_factory"),collectionManager:a("./collection_manager"),fetcher:a("./fetcher"),Model:a("./model"),Collection:a("./collection"),Controller:a("./controller"),Dispatcher:a("./dispatcher"),View:a("./views/base"),CollectionView:a("./views/collection"),ItemView:a("./views/item")}),c})},{"./app":1,"./collection":2,"./collection_factory":3,"./collection_manager":4,"./controller":5,"./dispatcher":6,"./fetcher":7,"./link_helper":9,"./mediator":10,"./mixin":11,"./model":12,"./model_factory":13,"./model_manager":14,"./views/base":15,"./views/collection":16,"./views/item":17}],9:[function(a,b){var c,d=a("./mediator");b.exports=c=function(){this.mediator=d,$(document).on("click","a",this.onClick.bind(this))},c.prototype.onClick=function(a){var b,c=$(a.currentTarget),d=c.attr("href"),e=c.data();d&&"#"!==d&&"javascript:;"!==d&&!a.metaKey&&(b=_.extend({trigger:!0},e),b.external||(a.preventDefault(),this.mediator.trigger("navigate",d,b)))}},{"./mediator":10}],10:[function(a,b){b.exports=_.extend({},Backbone.Events)},{}],11:[function(a,b){b.exports=function(){var b=Array.prototype.slice.apply(arguments);return _.each(b,function(b){_.isString(b)&&(b=a(Frame._app.get("mixinPath")+b)),this.prototype.events&&b.events&&_.merge(this.prototype.events,b.events),this.prototype.initialize&&(this.prototype.initialize=_.wrap(this.prototype.initialize,function(a){var c=Array.prototype.slice.call(arguments,1);b.init&&b.init.apply(this,c),a.apply(this,c),b.afterInit&&b.afterInit.apply(this,c)})),_.merge(this.prototype,b.props)},this),this}},{}],12:[function(a,b){var c,d=a("./model_manager"),e=a("./mediator"),f=a("./mixin");b.exports=c=Backbone.Model.extend({mediator:e,initialize:function(b,c){var d,e,f,g;return c||(c={}),this.associated=_.extend({},c.associated),this.expandFields=c.expandFields||this.expandFields,this.setFetched(!!c.fetched),this.expandFields&&_.each(this.expandFields,function(b){b=b.split(">"),f=b[0],g=this.get(f),1==b.length&&(b.push(g.length?"collections":"models"),b.push("base")),d=a(b[1]+"/"+b[2]),e=new d(g),this._watchNested(f,e),this.associated[f]=e},this),this.init.apply(this,arguments),this},init:function(){},_watchNested:function(a,b){var c=_.bind(this._updateNested,this,a,b);this.listenTo(b,"change",c),this.listenTo(b,"add",c),this.listenTo(b,"remove",c)},_updateNested:function(a,b){this.set(a,b.toJSON())},store:function(a){d.set(a,this)},reset:function(a,b){a||(a={}),this.clear(b),this.set(a,b)},collectionAt:function(){return this.collection.indexOf(this)},isFetched:function(){return this._fetched},setFetched:function(a){this._fetched=a,a&&(this.promise=$.Deferred().resolve(this))},fetch:function(){return this.promise=Backbone.Model.prototype.fetch.apply(this,arguments).then(function(){this.trigger("fetched"),this.setFetched(!0)}),this.trigger("fetch",this.promise),this.promise},fetchCached:function(a){return this.isFetched()?$.Deferred().resolve(this):this.promise&&"pending"===this.promise.state()?this.promise:this.fetch(a)},when:function(a,b){var c=$.Deferred(),d=this.get(a);return(b&&d===b||_.isUndefined(b)&&d)&&c.resolve.call(this,this,d),this.on("change:"+a,function(a,d){(_.isUndefined(b)&&d||d===b)&&c.resolve.apply(this,arguments)}),c},save:function(){this.trigger("save");var a=this.promise=Backbone.Model.prototype.save.apply(this,arguments);return a?a.then(function(){this.collection&&this.store(this.collection.modelName+":"+this.id),this.setFetched(!0),this.trigger("save:success")}.bind(this)).fail(function(a){this.trigger("save:failed",a)}.bind(this)):this.trigger("save:invalid"),a}}),c.mixin=f},{"./mediator":10,"./mixin":11,"./model_manager":14}],13:[function(a,b){b.exports=function(b,c,d){var e,f;if(!b)throw"Model type is required!";if(e=Frame._app.get("modelPath")+b,f=a(e),!f)throw e+" is an undefined model";return new f(c,d)}},{}],14:[function(a,b){var c=a("./model_factory");b.exports={get:function(a,b,d,e){var f,g=a+":";return g+=_.isFunction(b)?b(d,e):b,f=Frame._appModels[g],f&&f._TTL<=Date.now()&&(f=null),f||(f=c(a,d,e),this.set(g,f)),f},set:function(a,b){Frame._appModels[a]=b,b._TTL=Date.now()+(b.cacheTTL||3e5),b.on("change",this._updateTTL)},destroy:function(a){var b=Frame._appModels[a];b.off("change",this._updateTTL),delete Frame._appModels[a]},_updateTTL:function(){this._TTL=Date.now()+(this.cacheTTL||3e5)}}},{"./model_factory":13}],15:[function(a,b){function c(){}var d,e=a("../mediator"),f=a("../mixin"),g=["template","skipDependencies"];b.exports=d=Backbone.View.extend({init:c,afterRender:c,onRemove:c,onError:c,showLoader:c,hideLoader:c,mediator:e,spinOptions:{color:"#444",preset:"small"},initialize:function(a){function b(a){a&&a.promise&&"pending"===a.promise.state()&&c.push(a.promise)}a||(a={}),this._rendered=!1,this._views=[],this._errors=[],this.resources=_.extend({},a.resources),_.extend(this,_.pick(a,g)),this.data=_.extend({},this.data),a.data&&this.set(a.data),this.mediatorEvents&&this._attachMediatorEvents(),this.resourceEvents&&this._attachResourceEventsGroup(this.resourceEvents),this.$el.on("remove",_.bind(this.remove,this));var c=[];this.skipDependencies||(_.each(this.resources,b),this.model&&b(this.model),this.collection&&b(this.collection),c.length&&this.whenFetching(c)),this.init(a)},render:function(){var a={},b={};return this.fetching?this:(this.template&&(_.each(this.resources,function(b,c){b&&(a[c]=b.models?_.pluck(b.models,"attributes"):b.attributes)}),this.model&&(a.model=this.model.attributes),_.each(_.result(this,"data"),function(a,c){b[c]=this.get(c)},this),_.extend(a,b),this.$el.html(this.template(a))),this._rendered=!0,this.afterRender(this.resources),this)},get:function(a){return a=this.data[a],_.isFunction(a)?a.call(this):a},set:function(a,b){void 0===b?_.merge(this.data,a):this.data[a]=b,this._rendered&&this.render()},prepend:function(a,b){return _.isString(b)&&(b=this.$(b)),this._attach("prepend",a,b),this},prependTo:function(a){return this.prepend(this,a),this},append:function(a,b){return _.isString(b)&&(b=this.$(b)),this._attach("append",a,b),this},appendTo:function(a){return this.append(this,a),this},after:function(a,b){return _.isString(a)&&(a=this.$(a)),this._attach("after",b,a),this},before:function(a,b){return _.isString(a)&&(a=this.$(a)),this._attach("before",b,a),this},empty:function(){return this._removeNested(),this.$el.html(""),this},reset:function(a){_.isUndefined(a)&&(a=[]);var b=this._renderViews(a);return this.$el.html(b),this._removeNested(),this._viewsInserted(a),this},replaceWith:function(a){this.$el.after(a.render().el),a.delegateEvents(),a._onInsert(),this.remove(),this.listenTo(a,"all",this.trigger)},remove:function(){return this.hasRemoved||(this.hasRemoved=!0,this._removeMediatorEvents(),this._removeNested(),Backbone.View.prototype.remove.call(this),this.$el.off("remove"),this.onRemove()),this},getItemById:function(a){var b,c,d=a.attr("data-id");return b=this.collection.get(d?d:a.closest("[data-id]").attr("data-id")),b||(c=a.attr("data-cid"),b=this.collection.get(c?c:a.closest("[data-cid]").attr("data-cid"))),b},stopProp:function(a){return a&&a.stopPropagation&&(a.stopPropagation(),a.preventDefault()),this},stopPropagation:function(a){return a&&a.stopPropagation&&a.stopPropagation(),this},whenFetching:function(a){this.fetching||(!_.isArray(a)&&(a=[a]),this.fetching=!0,this.showLoader(a),$.when.apply($,a).always(function(){this.fetching=!1,this.hideLoader()}.bind(this)).then(this.afterFetch.bind(this),this.onError.bind(this)))},afterFetch:function(){this.render()},_onInsert:function(){this.hasRemoved=!1,this.onInsert&&_.defer(this.onInsert.bind(this))},_renderViews:function(a){return _.map(a,function(a){return a.render().el},this)},_viewsInserted:function(a){_.each(a,function(a){a!=this&&this._views.push(a),a._onInsert.call(a)},this)},_removeNested:function(){_.invoke(this._views,"remove"),this._views=[]},_attach:function(a,b,c){c||(c=this.$el),_.isArray(b)||(b=[b]);var d=this._renderViews(b);c[a](d),this._viewsInserted(b)},_attachMediatorEvents:function(a){(a||(a=_.result(this,"mediatorEvents")))&&(this._removeMediatorEvents(),_.each(a,function(a,b){if(_.isFunction(a)||(a=this[a]),!a)throw new Error("Method "+a+" does not exist");this.mediator.on(b,a,this)},this))},_removeMediatorEvents:function(){this.mediator.off(null,null,this)},_attachResourceEventsGroup:function(a){var b,c,d=this.resources;_.each(a,function(a,e){if(c=e.split("."),("collection"==c[0]||"model"==c[0])&&(d=this),b=c.reduce(function(a,b){return a[b]},d),!b)throw new Error(e+" not found in view to attach events to");this._attachResourceEvents(a,b)},this)},_attachResourceEvents:function(a,b){_.each(a,function(a,c){_.each(a.split(" "),function(a){if(_.isFunction(a)||(a=this[a]),!a)throw new Error("Method "+a+" does not exist");this.listenTo(b,c,a)},this)},this)}}),d.mixin=f},{"../mediator":10,"../mixin":11}],16:[function(a,b){function c(){}var d=a("./base"),e=["modelView","infinite","$infiniteTarget"];b.exports=d.extend({showEmpty:c,hideEmpty:c,collectionEvents:{reset:"render",add:"addOne hideEmpty",remove:"checkEmpty",fetch:"whenFetching"},initialize:function(a){d.prototype.initialize.apply(this,arguments),_.bindAll(this,"onScroll"),_.extend(this,_.pick(a,e)),this._setupInfinite(a),this._attachResourceEventsGroup({collection:this.collectionEvents})},render:function(){var a=this.template?this.template():"";return this.hideEmpty(),this.$el.html(a),this.fetching?this:(this.collection.length?this.collection.each(this.addOne,this):this.showEmpty(),this.afterRender(),this)},addOne:function(a){var b,c,d=this.collection.indexOf(a);return c=new this.modelView({model:a,resources:this.resources}),this.beforeEach&&c.$el.before(this.beforeEach(a)),b=this._viewElAt(d),b.length?this.before(b,c):this.append(c),this.afterEach&&c.$el.after(this.afterEach(a)),this._views.push(c),c},onScroll:function(){var a=this.$infiniteTarget.scrollTop()+this.$infiniteTarget.height(),b=this.$infiniteTarget.get(0).scrollHeight||$(document).height();if(a>=b-this.infniteOptions.offset&&!this.fetching&&this.prevScrollY<=a&&!this.infiniteEnd){var c=this.collection.length,d={remove:!1};if(!c&&this.collection.isFetched())return void(this.infiniteEnd=!0);this.infniteOptions.data&&(d.data=_.result(this.infniteOptions,"data")),this.collection.fetchNext(d).always(function(){this.collection.length===c&&(this.infiniteEnd=!0)}.bind(this))}this.prevScrollY=a},afterFetch:function(){this.checkEmpty()},checkEmpty:function(){0===this.collection.length?this.showEmpty():this.hideEmpty()},onRemove:function(){this.$infiniteTarget&&this.$infiniteTarget.off("scroll",this.onScroll)},_setupInfinite:function(){this.infinite&&(this.infniteOptions=_.extend({offset:300},this.infinite),this.$infiniteTarget=this.$infiniteTarget||this.$el,this.$infiniteTarget.on("scroll",this.onScroll))},_currentRenderedCount:function(){var a=this.modelView.prototype.className.split(" ")[0];return this.$("."+a).length},_viewElAt:function(a){var b=this.modelView.prototype.className.split(" ")[0];return this.$("."+b).eq(a)}})},{"./base":15}],17:[function(a,b){var c=a("./base");b.exports=c.extend({modelEvents:{change:"render",invalid:"onInvalid",remove:"removeItem"},initialize:function(){this.model&&this._attachResourceEvents(this.modelEvents,this.model),c.prototype.initialize.apply(this,arguments),this.collection=this.model.collection},removeItem:function(a,b,c){!c.silent&&this.remove()},onInvalid:function(){}})},{"./base":15}]},{},[8]);